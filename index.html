<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Đèn Trời Trung Thu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #1a1a2e, #16213e, #0f0c29);
            min-height: 100vh;
            overflow: hidden;
            position: relative;
             margin: 0;
            padding: 0;
        }
         /* Container chính với tỉ lệ điện thoại */
        .phone-container {
            width: 100%;
            max-width: 100vw;
            height: 100vh;
            position: relative;
            overflow: hidden;
        }

        /* Tối ưu cho tỉ lệ điện thoại 9:16 */
        @media (orientation: portrait) {
            .phone-container {
                width: 100vw;
                height: 100vh;
                max-height: calc(100vw * 16/9);
            }
            
            body {
                display: flex;
                justify-content: center;
                align-items: center;
                background: #000;
            }
        }

        /* Tối ưu cho màn hình ngang */
        @media (orientation: landscape) {
            .phone-container {
                width: calc(100vh * 9/16);
                height: 100vh;
                margin: 0 auto;
                border: 2px solid rgba(255, 215, 0, 0.3);
                border-radius: 20px;
                box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            }
            
            body {
                background: #000;
                display: flex;
                justify-content: center;
                align-items: center;
            }
        }
        /* Audio controls */
        .audio-control {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .audio-control button {
            background: rgba(255, 215, 0, 0.8);
            border: none;
            border-radius: 8px;
            padding: 10px 18px;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            font-family: Arial, sans-serif;
        }

        .audio-control button:hover {
            background: rgba(255, 215, 0, 1);
            transform: scale(1.05);
        }

        /* Trăng tròn to */
        .moon {
            position: absolute;
            top: 60px;
            right: 80px;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle at 30% 30%, #fff, #ffd700, #ffb347);
            border-radius: 50%;
            box-shadow: 
                0 0 60px rgba(255, 215, 0, 0.8),
                0 0 120px rgba(255, 215, 0, 0.4),
                inset -20px -20px 40px rgba(0, 0, 0, 0.1);
            animation: moonGlow 4s ease-in-out infinite alternate;
        }

        /* Các ngôi sao nhỏ */
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        .star:nth-child(1) { top: 15%; left: 10%; width: 2px; height: 2px; animation-delay: 0s; }
        .star:nth-child(2) { top: 20%; left: 80%; width: 3px; height: 3px; animation-delay: 0.5s; }
        .star:nth-child(3) { top: 35%; left: 75%; width: 2px; height: 2px; animation-delay: 1s; }
        .star:nth-child(4) { top: 25%; left: 25%; width: 2px; height: 2px; animation-delay: 1.5s; }
        .star:nth-child(5) { top: 40%; left: 15%; width: 3px; height: 3px; animation-delay: 2s; }

        /* Container cho đèn trời */
        .sky-lanterns {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        /* Đèn trời bay - dạng hình chữ nhật cao giống thật */
        .sky-lantern {
            position: absolute;
            width: 3.5vmin;
            height: 5.5vmin;
            background: linear-gradient(180deg,
                rgba(40, 30, 20, 0.6) 0%,
                rgba(80, 50, 30, 0.8) 15%,
                rgba(200, 120, 60, 0.95) 30%,
                rgba(255, 160, 80, 1) 50%,
                rgba(255, 140, 70, 1) 65%,
                rgba(220, 100, 50, 0.9) 85%,
                rgba(150, 70, 30, 0.7) 100%);
            border-radius: 25% 25% 50% 50% / 15% 15% 50% 50%;
            animation: floatUp linear infinite, sway 3s ease-in-out infinite, flicker 2s ease-in-out infinite;
            box-shadow: 
                0 0 3vmin rgba(255, 150, 80, 0.8),
                0 0 5vmin rgba(255, 120, 60, 0.5),
                0 0 8vmin rgba(255, 100, 40, 0.3),
                inset 0 -1vmin 2vmin rgba(0, 0, 0, 0.4),
                inset 0 1vmin 1vmin rgba(255, 200, 100, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            filter: brightness(1.1);
            clip-path: polygon(
                15% 0%, 85% 0%,
                90% 5%, 95% 15%,
                98% 30%, 100% 50%,
                98% 70%, 95% 85%,
                85% 95%, 50% 100%,
                15% 95%, 5% 85%,
                2% 70%, 0% 50%,
                2% 30%, 5% 15%,
                10% 5%
            );
        }

        .sky-lantern:hover {
            transform: scale(1.35) rotate(5deg);
            box-shadow: 
                0 0 4vmin rgba(255, 150, 80, 1),
                0 0 7vmin rgba(255, 120, 60, 0.8),
                0 0 11vmin rgba(255, 100, 40, 0.5);
            filter: brightness(1.4);
        }

        /* Lõi phát sáng bên trong - tập trung ở giữa và dưới */
        .sky-lantern::before {
            content: '';
            position: absolute;
            top: 35%;
            left: 20%;
            right: 20%;
            bottom: 15%;
            background: radial-gradient(ellipse at 50% 70%, 
                rgba(255, 255, 220, 1) 0%,
                rgba(255, 240, 180, 0.9) 15%,
                rgba(255, 220, 150, 0.7) 30%,
                rgba(255, 200, 120, 0.5) 50%,
                rgba(255, 180, 100, 0.3) 70%,
                transparent 90%);
            border-radius: 30% 30% 50% 50% / 20% 20% 60% 60%;
            animation: innerGlow 1.8s ease-in-out infinite alternate;
        }

        /* Hào quang phát sáng xung quanh - rộng hơn ở đỉnh */
        .sky-lantern::after {
            content: '';
            position: absolute;
            top: -2vmin;
            left: 50%;
            transform: translateX(-50%);
            width: 7vmin;
            height: 9vmin;
            background: radial-gradient(ellipse at 50% 60%, 
                rgba(255, 220, 120, 0.5) 0%,
                rgba(255, 180, 100, 0.3) 20%,
                rgba(255, 150, 80, 0.2) 40%,
                rgba(255, 120, 60, 0.1) 60%,
                transparent 80%);
            border-radius: 50%;
            animation: glowPulse 2.2s ease-in-out infinite;
            pointer-events: none;
        }

        /* Đèn lớn */
        .sky-lantern.large {
            width: 5vmin;
            height: 7.5vmin;
            box-shadow: 
                0 0 4vmin rgba(255, 150, 80, 1),
                0 0 7vmin rgba(255, 120, 60, 0.7),
                0 0 11vmin rgba(255, 100, 40, 0.4);
            filter: brightness(1.25);
        }

        .sky-lantern.large::after {
            width: 9vmin;
            height: 11vmin;
        }

        /* Đèn nhỏ */
        .sky-lantern.small {
            width: 2.8vmin;
            height: 4.2vmin;
            box-shadow: 
                0 0 2vmin rgba(255, 150, 80, 0.7),
                0 0 4vmin rgba(255, 120, 60, 0.4),
                0 0 6vmin rgba(255, 100, 40, 0.2);
            filter: brightness(1);
        }

        .sky-lantern.small::after {
            width: 5vmin;
            height: 7vmin;
        }


        /* Animation bay lên */
        @keyframes floatUp {
            0% {
                transform: translateY(100vh) translateX(0px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-200px) translateX(var(--drift));
                opacity: 0;
            }
        }

        /* Animation cho trăng */
        @keyframes moonGlow {
            0% { 
                box-shadow: 
                    0 0 60px rgba(255, 215, 0, 0.6),
                    0 0 120px rgba(255, 215, 0, 0.3);
            }
            100% { 
                box-shadow: 
                    0 0 80px rgba(255, 215, 0, 0.9),
                    0 0 160px rgba(255, 215, 0, 0.5);
            }
        }

        /* Animation cho sao */
        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.5); }
        }

        /* Text chúc mừng */
        .greeting {
            position: absolute;
            bottom: 80px;
            width: 100%;
            text-align: center;
            font-family: 'Arial', sans-serif;
            color: #ffd700;
            font-size: 32px;
            font-weight: bold;
            text-shadow: 2px 2px 15px rgba(255, 215, 0, 0.8);
            animation: textGlow 3s ease-in-out infinite alternate;
            z-index: 100;
        }

        .greeting-sub {
            font-size: 18px;
            margin-top: 10px;
            color: rgba(255, 255, 255, 0.8);
        }

        @keyframes textGlow {
            0% { text-shadow: 2px 2px 15px rgba(255, 215, 0, 0.5); }
            100% { text-shadow: 2px 2px 25px rgba(255, 215, 0, 1); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .moon {
                width: 120px;
                height: 120px;
                top: 40px;
                right: 40px;
            }
            .greeting {
                font-size: 26px;
                bottom: 60px;
            }
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* Modal cho lời nhắn */
        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .message-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            border: 2px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.2);
            position: relative;
            animation: modalAppear 0.5s ease-out;
        }

        .message-image {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            background-size: cover;
            background-position: center;
            border: 3px solid #ffd700;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .message-text {
            color: #ffd700;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 2px 2px 10px rgba(255, 215, 0, 0.5);
        }

        .message-subtext {
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 20px;
        }

        .close-button {
            background: rgba(255, 215, 0, 0.8);
            border: none;
            border-radius: 10px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .close-button:hover {
            background: rgba(255, 215, 0, 1);
            transform: scale(1.05);
        }

        @keyframes modalAppear {
            0% {
                opacity: 0;
                transform: scale(0.8) translateY(50px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
    </style>
</head>
<body>
    <!-- Audio Control -->
    <div class="audio-control">
        <button onclick="toggleMusic()">🎵 Bật nhạc Trung Thu</button>
        <audio id="bgMusic" autoplay loop>
            <source src="Download.mp3" type="audio/mpeg">
        </audio>
    </div>

    <!-- Trăng và sao -->
    <div class="moon"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>

    <!-- Container đèn trời -->
    <div class="sky-lanterns" id="skyLanterns">
    </div>

    <!-- Lời chúc -->
    <div class="greeting">
        Chúc Mừng Tết Trung Thu
        <div class="greeting-sub">🏮 Click vào đèn trời để xem lời chúc của mình 🏮</div>
    </div>

    <!-- Modal hiển thị lời nhắn -->
    <div class="message-modal" id="messageModal">
        <div class="message-content">
            <div class="message-image" id="messageImage"></div>
            <div class="message-text" id="messageText"></div>
            <div class="message-subtext" id="messageSubtext"></div>
            <button class="close-button" onclick="closeModal()">Đóng</button>
        </div>
    </div>

    <script>
        let audioContext;
        let isPlaying = false;
        let melodyInterval;
        let ambientInterval;
        let currentMessageIndex = 0; // Thêm biến theo dõi thứ tự

        // Mảng chứa các lời nhắn và ảnh
        const messages = [
            {
                text: "Chúc Nguyên Trung Thu vui vẻ!",
                subtext: "Gia đình sum vầy, hạnh phúc bên nhau dưới ánh trăng rằm",
                image: "h.jpg"
            },
            {
                text: "Bánh trung thu ngọt ngào!",
                subtext: "Ngọt ngào như bánh trung thu, ấm áp như vầng trăng rằm",
                image: "g.jpg"
            },
            {
                text: "Ước nguyện bay cao!",
                subtext: "Mọi ước nguyện của Nguyên sẽ bay cao như những chiếc đèn trời",
                image: "n.jpg"
            },
            {
                text: "Trăng tròn người tròn!",
                subtext: "Chúc mọi điều tốt đẹp sẽ đến với nguyên và người thân",
                image: "hung.jpg"
            },
            {
                text: "Thỏ ngọc gửi lời chúc!",
                subtext: "Thỏ ngọc trên cung trăng gửi đến nguyên những điều may mắn nhất",
                image: "c.jpg"
            },
            {
                text: "Hoa đăng rực rỡ!",
                subtext: "Ánh sáng hoa đăng sẽ thắp sáng con đường thành công của nguyên",
                image: "nguyen.jpg"
            }
        ];

        // Hiển thị modal với lời nhắn theo thứ tự
        function showMessage() {
            // Lấy lời nhắn theo thứ tự, quay lại đầu khi hết
            const currentMessage = messages[currentMessageIndex];
            
            document.getElementById('messageText').textContent = currentMessage.text;
            document.getElementById('messageSubtext').textContent = currentMessage.subtext;
            document.getElementById('messageImage').style.backgroundImage = `url("${currentMessage.image}")`;
            
            document.getElementById('messageModal').style.display = 'flex';
            
            
             // Tăng index cho lần click tiếp theo
            currentMessageIndex = (currentMessageIndex + 1) % messages.length;
            // Phát âm thanh chuông
            if (audioContext && isPlaying) {
                playBellSound();
            }
        }

        // Đóng modal
        function closeModal() {
            document.getElementById('messageModal').style.display = 'none';
        }

        // Phát âm thanh chuông khi mở modal
        function playBellSound() {
            const bell = audioContext.createOscillator();
            const bellGain = audioContext.createGain();
            
            bell.connect(bellGain);
            bellGain.connect(audioContext.destination);
            
            bell.frequency.setValueAtTime(800, audioContext.currentTime);
            bell.frequency.exponentialRampToValueAtTime(400, audioContext.currentTime + 0.5);
            
            bellGain.gain.setValueAtTime(0.2, audioContext.currentTime);
            bellGain.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            bell.start();
            bell.stop(audioContext.currentTime + 1);
        }

        // Tạo giai điệu nhạc Trung Thu
        function createTraditionalMelody() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }

            const notes = [
                { freq: 523.25, duration: 0.6 }, // C5
                { freq: 587.33, duration: 0.6 }, // D5  
                { freq: 659.25, duration: 0.6 }, // E5
                { freq: 698.46, duration: 0.8 }, // F5
                { freq: 783.99, duration: 0.4 }, // G5
                { freq: 659.25, duration: 0.6 }, // E5
                { freq: 587.33, duration: 0.6 }, // D5
                { freq: 523.25, duration: 1.2 }, // C5
            ];

            let currentTime = audioContext.currentTime;
            
            notes.forEach(note => {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(note.freq, currentTime);
                
                gainNode.gain.setValueAtTime(0, currentTime);
                gainNode.gain.linearRampToValueAtTime(0.08, currentTime + 0.05);
                gainNode.gain.exponentialRampToValueAtTime(0.05, currentTime + note.duration * 0.8);
                gainNode.gain.exponentialRampToValueAtTime(0.01, currentTime + note.duration);
                
                oscillator.start(currentTime);
                oscillator.stop(currentTime + note.duration);
                
                currentTime += note.duration;
            });
            
            return currentTime - audioContext.currentTime;
        }

        function createAmbientSound() {
            if (!audioContext) return;

            const cricket = audioContext.createOscillator();
            const cricketGain = audioContext.createGain();
            
            cricket.connect(cricketGain);
            cricketGain.connect(audioContext.destination);
            
            cricket.frequency.setValueAtTime(3500 + Math.random() * 1500, audioContext.currentTime);
            cricketGain.gain.setValueAtTime(0.01, audioContext.currentTime);
            cricketGain.gain.linearRampToValueAtTime(0.03, audioContext.currentTime + 0.1);
            cricketGain.gain.linearRampToValueAtTime(0, audioContext.currentTime + 0.4);
            
            cricket.start();
            cricket.stop(audioContext.currentTime + 0.4);
        }

        function toggleMusic() {
            const audio = document.getElementById('bgMusic');
            
            if (!isPlaying) {
                if (!audioContext) {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                }
                
                audio.play().catch(() => {
                    console.log('Sử dụng Web Audio API');
                });
                
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
                playTraditionalMelodyLoop();
                playAmbientLoop();
                
                isPlaying = true;
                updateButtonText();
            } else {
                audio.pause();
                if (audioContext) {
                    audioContext.suspend();
                }
                if (melodyInterval) clearInterval(melodyInterval);
                if (ambientInterval) clearInterval(ambientInterval);
                isPlaying = false;
                updateButtonText();
            }
        }

        function updateButtonText() {
            const button = document.querySelector('.audio-control button');
            button.innerHTML = isPlaying ? '🎵 Đang phát nhạc' : '🎵 Bật nhạc Trung Thu';
        }

        function playTraditionalMelodyLoop() {
            if (melodyInterval) clearInterval(melodyInterval);
            
            const melodyDuration = createTraditionalMelody();
            
            melodyInterval = setInterval(() => {
                if (isPlaying) {
                    createTraditionalMelody();
                }
            }, (melodyDuration + 4) * 1000);
        }
        
        function playAmbientLoop() {
            if (ambientInterval) clearInterval(ambientInterval);
            
            ambientInterval = setInterval(() => {
                if (isPlaying && Math.random() > 0.7) {
                    createAmbientSound();
                }
            }, 2000);
        }

        // Tạo đèn trời bay
        function createSkyLantern() {
            const container = document.getElementById('skyLanterns');
            const lantern = document.createElement('div');
            
            // Random size
            const sizes = ['small', '', 'large'];
            const randomSize = sizes[Math.floor(Math.random() * sizes.length)];
            lantern.className = `sky-lantern ${randomSize}`;
            
            // Thêm event click để hiện modal
            lantern.addEventListener('click', function(e) {
                e.stopPropagation();
                showMessage();
            });
            
            // Random starting position
            const startX = Math.random() * window.innerWidth;
            const drift = (Math.random() - 0.5) * 200;
            
            lantern.style.left = startX + 'px';
            lantern.style.setProperty('--drift', drift + 'px');
            
            // Random animation duration
            const duration = 15 + Math.random() * 10;
            lantern.style.animationDuration = duration + 's';
            
            // Random delay
            const delay = Math.random() * 3;
            lantern.style.animationDelay = delay + 's';
            
            container.appendChild(lantern);
            
            // Xóa đèn sau khi animation kết thúc
            setTimeout(() => {
                if (lantern.parentNode) {
                    lantern.parentNode.removeChild(lantern);
                }
            }, (duration + delay) * 1000);
        }

        
        function startLanternShow() {
            // Tạo đèn mới mỗi 0.8-2 giây
            setInterval(() => {
                createSkyLantern();
            }, 800 + Math.random() * 1200);
            
            // Tạo một loạt đèn ngay lập tức để có hiệu ứng đầy đủ
            for(let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createSkyLantern();
                }, i * 300);
            }
        }

        // Khởi động
        document.addEventListener('DOMContentLoaded', function() {
            startLanternShow();
            
            // Pulse button sau 3 giây
            setTimeout(() => {
                const button = document.querySelector('.audio-control button');
                button.style.animation = 'pulse 2s infinite';
            }, 3000);
        });

        // Tạo đèn mới khi click vào màn hình
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.audio-control') && !e.target.closest('.message-modal')) {
                // Tạo 3-5 đèn mới từ vị trí click
                const numLanterns = 3 + Math.floor(Math.random() * 3);
                for(let i = 0; i < numLanterns; i++) {
                    setTimeout(() => {
                        const container = document.getElementById('skyLanterns');
                        const lantern = document.createElement('div');
                        
                        lantern.className = 'sky-lantern large';
                        
                        // Thêm event click cho đèn mới
                        lantern.addEventListener('click', function(e) {
                            e.stopPropagation();
                            showMessage();
                        });
                        
                        lantern.style.left = (e.clientX - 17 + (Math.random() - 0.5) * 100) + 'px';
                        lantern.style.bottom = (window.innerHeight - e.clientY - 35) + 'px';
                        lantern.style.setProperty('--drift', (Math.random() - 0.5) * 150 + 'px');
                        lantern.style.animationDuration = (12 + Math.random() * 8) + 's';
                        
                        container.appendChild(lantern);
                        
                        setTimeout(() => {
                            if (lantern.parentNode) {
                                lantern.parentNode.removeChild(lantern);
                            }
                        }, 20000);
                    }, i * 100);
                }
            }
        });

        // Đóng modal khi click outside hoặc phím ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });

        document.getElementById('messageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>
</html>